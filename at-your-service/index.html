<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>At your service!</title>
    <meta name="description" content="A short review about service workers: what are they, what is the current status, what is coming and what you can do right now!">
    <meta name="author" content="Salvador de la Puente González">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <link rel="stylesheet" href="css/reveal.min.css">
    <link rel="stylesheet" href="css/theme/firefoxos.css" id="theme">

    <!-- For syntax highlighting -->
    <link rel="stylesheet" href="lib/css/zenburn.css">

    <!-- If the query includes 'print-pdf', use the PDF print sheet -->
<script>
  if( window.location.search.match( /print-pdf/gi ) ) {
    var link = document.createElement( 'link' );
    link.rel = 'stylesheet';
    link.type = 'text/css';
    link.href = 'css/print/pdf.css';
    document.getElementsByTagName( 'head' )[0].appendChild( link );
  }
</script>
    <!--[if lt IE 9]>
    <script src="lib/js/html5shiv.js"></script>
    <![endif]-->
  </head>

  <body>
    <div class="reveal">

      <div class="slides">
        <section data-markdown>
          # At Your Service!
          ## More than appcache uses for Service Workers
        </section>

        <section data-markdown>
          ## Index
          1. Progressive apps
          2. What is a Service Worker?
          3. The State of the Art
          4. A man in the middle
        </section>

        <section>
          <section data-markdown>
            ## Progressive apps
          </section>

          <section data-markdown>
            &gt; These apps aren’t packaged and deployed through stores, they’re **just
            &gt; websites** that took all the right vitamins. They keep the web’s
            &gt; ask-when-you-need-it permission model and add in new capabilities
            &gt; like being **top-level** in your task switcher, on your home screen, and
            &gt; in your notification tray.

            Alex Russell in [Progressive Web Apps](https://infrequently.org/2015/06/progressive-apps-escaping-tabs-without-losing-our-soul/)
          </section>

          <section data-markdown>
            * Responsive
            * **Connectivity independent**
            * App-like-interactions
            * **Installable**
            * Fresh (always up to date)
            * Discoverable
            * **Re-engageable**
            * Linkable
          </section>
          
          <section>
            <img src="./imgs/add-to-home-screen.gif" />
          </section>

          <section>
            <iframe width="560" height="315" src="https://www.youtube.com/embed/MxTaDhwJDLg" frameborder="0" allowfullscreen></iframe>
            <p><a href="http://tech-blog.flipkart.net/2015/11/progressive-web-app/" target="_blank">Flipkart</a></p>
          </section>
          
          <section>
            <video controls style="width: 300px;" src="http://nolanlawson.s3.amazonaws.com/vid/pokedex-install-banner.webm"></video>
            <p><a href="http://www.pocketjavascript.com/blog/2015/11/23/introducing-pokedex-org">Introducing pokedex.org</a></p>
          </section>

          <section data-markdown>
            ### Enters WADI
            &gt; In 2015, Mozilla is launching a new initiative to energize mobile web app development.
            &gt; (...)
            &gt; By making web apps that work offline and can reengage users, we believe developers will deliver experiences that will redefine the role of the web on mobile devices.

            **W**eb **A**pp **D**eveloper **I**nitiative

            [Go!](https://wiki.mozilla.org/Apps)
          </section>
        </section>

        <section>
          <section data-markdown>
            ## What is a service worker?
          </section>

          <section data-markdown>
            It is an **event driven** worker that does not need any client to be alive,
            it's **tied to its registration** only.

            ![SW lifecycle](./imgs/events.png)
          </section>
          
          <section data-markdown>
            In particular, `fetch` API is a request hijacker

            ![Fetch API](./imgs/fetch-api.png)

            I.e. a **man in the middle.**
          </section>

          <section data-markdown>
            How to **register** a service worker?
            ```js
            // index.js
            if ('serviceWorker' in navigator) {
              navigator.serviceWorker.register('path/to/sw.js', {
                scope: 'path/to/scope/'
              }).then(...);
            }
            ```
          </section>

          <section data-markdown>
            How to handle **life cycle**?
            ```js
            // service-worker.js
            self.oninstall = function (event) {
              event.waitUntil(setupCurrentWorker());
            };
            self.onactivate = function (event) {
              event.waitUntil(teardownPreviousWorker());
            };
            self.onfetch = function (event) {
              event.respondWith(fetch(event.request)); // pass through
            }
            ```
            [Complete life cycle](https://github.com/delapuente/service-workers-101/blob/master/sw101-letter-sA.svg)
          </section>
          
          <section data-markdown>
            How to know your **worker is ready**?
            ```js
            // client.js
            if ('serviceWorker' in navigator) {
              navigator.serviceWorker.register('path/to/sw.js');
              navigator.serviceWorker.ready.then(/* You know is ready! */);
            }
            ```
          </section>

          <section data-markdown>
            ### Service Worker 101
            An [infographic on GitHub](https://github.com/delapuente/service-workers-101)

            Your [copy for free](sw-101.pdf)
          </section>
        </section>

        <section>
          <section data-markdown>
            ## The man in the middle

            off-label uses of Service Workers
          </section>

          <section data-background="imgs/masterchef.png" data-markdown>
            ### The Service Worker Cookbook
            &gt; This cookbook contains dozens of practical, detailed, and working examples of service worker usage. These examples are for developers from beginner to expert and illustrate a number of APIs.

            Take a [look](https://serviceworke.rs)!
          </section>

          <section data-markdown>
            ### API analytics
            A direct application of a man in the middle. We use a service worker
            to hijack the request, log some info and allow the request to complete.

            [Demo](https://serviceworke.rs/api-analytics.html)
          </section>

          <section data-markdown>
            ### Cache from zip
            More traditional use of service worker, it demonstrate an offline usage
            but instead of caching every resource from its URL, it's caching all
            the resources at the same time in a ZIP package.

            [Demo](https://serviceworke.rs/cache-from-zip.html)
          </section>

          <section data-markdown>
            ### Virtual Server
            How about writing a REST API in the client side? It is possible with
            Service Workers and a little help from
            [ServiceWorkerWare](https://gihub.com/gaia-components/serviceworkerware)!

            [Demo](https://serviceworke.rs/virtual-server.html)
          </section>

          <section data-markdown>
            ### Render store
            A lot of frameworks rely on template interpolation to render the model.
            The NGA from Firefox OS introduces a kind of storage to store the interpolated
            pages to [avoid interpolation delay](http://unoyunodiez.com/2015/09/07/modern-mobile-web-development-breaking-the-rules-beating-delays-improving-responsiveness-and-performance-ii/) upon a second request.

            [Demo](http://localhost:8008)
          </section>

          <section data-markdown>
            ### Dependency injection
            Dependency injection is a technique that frees modules to create its dependencies.
            Instead, modules declare the abstract APIs they will use and a service called _injector_
            is used to provide the concrete implementations.

            [Demo](https://serviceworke.rs/dependency-injector.html)
          </section>

          <section data-markdown>
            ### Request deferrer
            This technique withhold requests in a queue while offline to later recreate
            the sequence of requests to the server once connectivity returns. It can be used
            for agnostic back-end synchronization systems embedded in modern frameworks.

            [Demo](http://localhost:3003/session-deferrer.html)
          </section>
        </section>

        <section>
          <section data-markdown>
            ## The state of the art
          </section>

          <section>
            <h3>Browser support</h3>
            <ul>
              <li>In Chrome? <span class="fragment">yes!</span></li>
              <li class="fragment">And in Android Browser and Chrome for Android!</li>
              <li class="fragment">In Nightly? <span class="fragment"><a href="https://developer.mozilla.org/en-US/docs/Web/API/ServiceWorker_API/Using_Service_Workers#Setting_up_to_play_with_Service_Workers">yes</a>!</span></li>
              <li class="fragment">In Firefox? <span class="fragment">not <a href="https://bugzilla.mozilla.org/show_bug.cgi?id=1059784" target="_blank">yet</a> <code>:(</code></span></li>
              <li class="fragment">And in Firefox OS? <span class="fragment">Just under <a href="https://blog.wanderview.com/blog/2015/03/24/service-workers-in-firefox-nightly/">test</a></span></li>
            </ul>
          </section>

          <section data-markdown>
            ### Where to check?
            * [is ServiceWorker ready?](https://jakearchibald.github.io/isserviceworkerready/)
            * [Can I use ... ?](http://caniuse.com/)
            * [Platform Status](https://mozilla.github.io/platatus/)
          </section>

          <section data-markdown>
            ### Major problems and workarounds
              * ~~No storage on Firefox! Use an offline cache.~~
              * ~~No `self.clients.claim()` implementation on Firefox! Use reload pattern.~~
              * No **dev tools** on Firefox! Use Chrome `:_(`
          </section>

          <section data-markdown>
            ### Tools &amp; resources
            * [serviceworke.rs](https://serviceworke.rs)<br/>for use cases &amp; best practices
            * [oghliner](https://github.com/mozilla/oghliner)<br/>to bootstrap a Service Worker enabled app.
            * [ServiceWorkerWare](https://github.com/gaia-components/serviceworkerware)<br/>to ease Service Worker authoring.
            * [offliner](https://github.com/delapuente/offliner)<br/>for adding a life cycle to your app.
            * [sw-toolbox](https://github.com/GoogleChrome/sw-toolbox)<br/>another similar tool to ServiceWorkerWare.
            * [upup](https://www.talater.com/upup/)<br/>a tool for _offlining_ your app.
          </section>

        </section>

        <section>
          <img src="imgs/chibi.png" alt="me" style="border:none; width: 250px; height:auto;"/>
          <p>Salvador de la Puente González</p>
          <p><a href="https://twitter.com/salvadelapuente">@salvadelapuente</a></p>
          <p><a href="http://github.com/delapuente">http://github.com/delapuente</a></p>
          <p><a href="https://delapuente.github.io/presentations/">https://delapuente.github.io/presentations/</a></p>
        </section>

        <section data-markdown data-background="imgs/butler.jpg">
          ## Questions?
        </section>

      </div>

    </div>

    <script src="lib/js/head.min.js"></script>
    <script src="js/reveal.min.js"></script>

    <script>

      // Full list of configuration options available here:
      // https://github.com/hakimel/reveal.js#configuration
      Reveal.initialize({
        controls: true,
        progress: true,
        history: true,
        center: true,

        theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
        transition: Reveal.getQueryHash().transition || 'linear', // default/cube/page/concave/zoom/linear/fade/none

        // Optional libraries used to extend on reveal.js
        dependencies: [
          { src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
          { src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
          { src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
          { src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
          { src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
        ]
      });

    </script>

  </body>
</html>
